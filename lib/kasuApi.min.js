"use strict";const Parser=require("./src/parser.min"),{log:log,error:error}=require("console"),{connect:connect}=require("http2");module.exports=class{#e;constructor(e,t,n){this.url=t||"https://nhentai.net",this.#e,this.IsDiscord=!1,this.blockedWords="",this.ReRollonFail=!1,this.IgnoreNone=!1,this.connection={start:e=>{1==e&&(log("Connection is started!"),log(`Connection: ${this.url}`)),this.#e?error("WARN ERROR: Connection is already made."):this.#e=connect(this.url)},close:e=>{if(1==e&&log("Connection is closed!"),!this.#e)throw"ERROR: No connection is made.";this.#e.close()},status:()=>{let e="Not connected";return this.#e&&(e="Connected"),e}},e&&"start"==e.toLowerCase()&&(1==n&&(log("Connection is started!"),log(`Connection: ${this.url}`)),this.#e=connect(this.url))}#t(e){return Math.random()*e<<0}#n(e,t){return e.replace(/ /g,t)}async#r(e,t,n){return t||(t=""),t=/\.net/.test(this.url)?n?`${this.url}/${e}/?q=${t}/`:`${this.url}/${e}/${t}/`:n?`${this.url}/${e}?q=${t}`:`${this.url}/${e}/${t}`,await Parser.page(1,t,this.#e)}async#s(e,t,n,r){const s=e,a=this.#t(s[0].TotalPage),i=s[0].CurrentUrl;let o=await Parser.page(a,i,this.#e);o.shift();const c=this.#t(o.length);try{let e=await Parser.book(o[c].url,this.#e,{Search:n,"Ignore None":this.IgnoreNone,"Censored Words":this.blockedWords,Discord:this.IsDiscord,"ReRoll on Fail":this.ReRollonFail,"Include More":r});return t?t(e):e}catch(e){if(this.ReRollonFail&&!/DISCORD ToS: REROLL DENIED/.test(e))return this.#s(s,t,n);throw e}}async pRandSpecificTags(e,t,n){e=this.#n(e,"+");const r=await this.#r("search",e,!0);return r?this.#s(r,n,null,t):r}pRandTag(e,t,n){return this.#a(e,t,n,"tag")}pRandParody(e,t,n){return this.#a(e,t,n,"parody")}pRandArtist(e,t,n){return this.#a(e,t,n,"artist")}pRandGroup(e,t,n){return this.#a(e,t,n,"group")}async#a(e,t,n,r){e=this.#n(e,"-");const s=await this.#r(r,e);return s?this.#s(s,n,e,t):s}getID(e,t){if(/https:\/\/nhentai/.test(e)&&!(e=+e.replace(`${this.url}/g/`,"").replace("/","")))throw"ERROR: \n    \n                1. You are trying to access a different domain. Please change the URL on the constructor.\n                2. Entered link is Invalid.\n                \n                NOTE: If you are using a full link string please check if the domain matches the URL on the constructor.\n                \n                ";return"number"!=typeof e&&(e=+e),{json:async n=>{const r=await Parser.book(`${this.url}/g/${e}/`,this.#e,{Search:null,"Ignore None":this.IgnoreNone,"Censored Words":this.blockedWords,Discord:this.IsDiscord,"ReRoll on Fail":null,"Include More":t});return n?n(r):r}}}async pRandom(e,t){try{let n=await Parser.book(`${this.url}/random`,this.#e,{Search:null,"Ignore None":this.IgnoreNone,"Censored Words":this.blockedWords,Discord:this.IsDiscord,"ReRoll on Fail":this.ReRollonFail,"Include More":t});return e?e(n):n}catch(t){return this.pRandom(e)}}async pRandID(){return(await Parser.book(`${this.url}/random`,this.#e,{Search:null,"Ignore None":this.IgnoreNone})).id}async pHomepage(e){return await Parser.page(e,this.url,this.#e)}async pLanguagePage(e,t){if(/translated|english|japanese|chinese|eng|japan|china|jp/.test(e)){switch(e){case"eng":case"en":e="english";break;case"japan":case"jp":e="japanese";break;case"china":e="chinese"}return e=`${this.url}/language/${e}/`,await Parser.page(t,e,this.#e)}throw this.#e.close(),"ERROR: Invalid language (except: translated) lol"}async pSearch(e,t){try{e=this.#n(e,"+")}catch(e){}return e=/\.net/.test(this.url)?`${this.url}/search/?q=${e}/`:`${this.url}/search?q=${e}`,await Parser.page(t,e,this.#e)}async pTagPage(e,t){try{e=this.#n(e,"+")}catch(e){}return e=(/\.net/.test(this.url),`${this.url}/tag/${e}`),await Parser.page(t,e,this.#e)}};
